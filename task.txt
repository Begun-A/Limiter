Тестовое задание

Контекст

Есть распределенная ферма краулеров, которая краулит веб.
Один и тот же домен может краулиться с разных хостов, свое состояние между собой они не синхронизируют.
Краулеры после совершения цепочки request - response могут устанавливать задержку перед отправкой следующего запроса.


Проблема

Количество хостов, которое краулит 1 домен(ip) может быть как 1 так и 1000.
Следовательно, нагрузка на сервер(а) домена тоже может увеличиваться в 1000 раз, что приводит к DDOS эффекту, которого необходимо избегать.


Задание

Разработать микросервис, который управляет throttling’ом краулинга для домена для всей фермы.
Максимальная нагрузка на домен должна регулироваться правилом вида “максимум Х запросов со всех хостов в течении Y секунд”.

Взаимодействие с краулером: краулер после получения каждого респонса
Отправляет на микросервис HTTP запрос с доменом с которого запрашивалась страница и время генерации последней страницы.
Получает время задержки перед отправкой следующего запроса.


Требования к реализации
asyncio, tornado или twisted.
Rest API.
Юнит тест корректности работы алгоритма.
Объяснить как будет масштабироваться такой сервис для 9.000.000 доменов и какие ресурсы для этого потребуются.